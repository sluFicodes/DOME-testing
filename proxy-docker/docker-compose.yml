version: '3'
services:
    mongo:
        image: mongo:6.0
        ports:
            - 27017:27017
        networks:
            main:
        volumes:
            - ./proxy-data:/data/db

    proxy:
        image: proxy-system-dev
        extra_hosts:
            - "host.docker.internal:172.17.0.1"
            - "proxy.docker:127.0.0.1"

        links:
            - mongo
        depends_on:
            - mongo
        ports:
            - 8004:8004
        networks:
            main:
                aliases:
                    - proxy.docker
        environment:
          # MongoDB Configuration
          - BAE_LP_MONGO_SERVER=mongo
          - BAE_LP_MONGO_PORT=27017
          - BAE_LP_MONGO_DB=belp_db

          # Service Configuration
          - BAE_LP_PORT=8004
          - BAE_LP_HOST=0.0.0.0

          # Charging Backend Connection
          - BAE_LP_CHARGING_SERVER=http://charging.docker:8006

          # TMForum APIs - Product Catalog (cada API en su puerto, sin path)
          - BAE_LP_ENDPOINT_CATALOG_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_CATALOG_PORT=8632
          - BAE_LP_ENDPOINT_RESOURCE_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_RESOURCE_PORT=8636
          - BAE_LP_ENDPOINT_SERVICE_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_SERVICE_PORT=8637

          # TMForum APIs - Inventory
          - BAE_LP_ENDPOINT_INVENTORY_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_INVENTORY_PORT=8642
          - BAE_LP_ENDPOINT_RESOURCE_INVENTORY_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_RESOURCE_INVENTORY_PORT=8641
          - BAE_LP_ENDPOINT_SERVICE_INVENTORY_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_SERVICE_INVENTORY_PORT=8643

          # TMForum APIs - Party & Ordering
          - BAE_LP_ENDPOINT_PARTY_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_PARTY_PORT=8633
          - BAE_LP_ENDPOINT_ORDERING_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_ORDERING_PORT=8639

          # TMForum APIs - Billing & Usage
          - BAE_LP_ENDPOINT_CUSTOMER_BILL_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_CUSTOMER_BILL_PORT=8645
          - BAE_LP_ENDPOINT_BILLING_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_BILLING_PORT=8644
          - BAE_LP_ENDPOINT_USAGE_HOST=host.docker.internal
          - BAE_LP_ENDPOINT_USAGE_PORT=8080

          # OAuth2 Configuration
          - BAE_LP_OAUTH2_SERVER=http://idm.docker:3000
          - BAE_LP_OAUTH2_CLIENT_ID=${CLIENT_ID}
          - BAE_LP_OAUTH2_CLIENT_SECRET=${CLIENT_SECRET}
          - BAE_LP_OIDC_KEY=${OIDC_KEY}
          - BAE_LP_OAUTH2_ADMIN_ROLE=admin
          - BAE_LP_OAUTH2_SELLER_ROLE=seller
          - BAE_LP_OAUTH2_CUSTOMER_ROLE=customer
          - BAE_LP_OAUTH2_ORG_ADMIN_ROLE=orgAdmin

          # SIOP Configuration
          - BAE_LP_SIOP_ENABLED=false

          # Theme
          - BAE_LP_THEME=

          # Portal Configuration
          - BAE_LP_EXTERNAL_PORTAL=http://localhost:4200
          - BAE_LP_BILLING_ENGINE_URL=http://host.docker.internal:8006/charging/api/orderManagement/orders/preview/
          - BAE_LP_PURCHASE_ENABLED=true

networks:
    main:
        external: true
